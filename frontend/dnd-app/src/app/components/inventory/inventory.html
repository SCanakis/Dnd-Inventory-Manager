<app-basic-character-info-component></app-basic-character-info-component>
<app-nav-component></app-nav-component>

<div class="inventory-container">
  <!-- ADD THIS: Demo header that was missing from your HTML -->
  <div class="demo-header">    
    <!-- <h2>Character Inventory</h2>     -->
    <app-coin-purse-component></app-coin-purse-component>
  </div>

  <!-- ADD THIS: Search section at the top level -->
  <div class="search-section">
    <div class="search-container">
      <input 
        type="text" 
        [(ngModel)]="searchTerm" 
        (input)="onSearchTerm()" 
        placeholder="Search items by name"
      >
    </div>
  </div>

  <div class="content-layout">
    
    <div class="containers-sidebar">
      <div class="container-section">
        <h2>Character Containers</h2>
        <div *ngIf="currentContainer.length > 0">
          <div class="container-list-scroll">
            <ul>
              <!-- All Items button -->
              <li (click)="getAllItems()" 
                  class="container-item all-items-container">
                <span>All Items</span>
              </li>

              <!-- Container drop zones -->
              <li *ngFor="let containerView of currentContainer" 
                  (click)="getContainerItems(containerView.container.id.containerUuid)" 
                  class="container-item"
                  (dragover)="onDragOver($event)"
                  (dragenter)="onDragEnter($event, containerView.container.id.containerUuid)"
                  (dragleave)="onDragLeave($event)"
                  (drop)="onDrop($event, containerView.container.id.containerUuid)"
                  [class.drag-over]="dragOverContainer === containerView.container.id.containerUuid"
                  [class.can-drop]="canDropOnContainer(containerView.container.id.containerUuid)"
                  [class.cannot-drop]="draggedItem && !canDropOnContainer(containerView.container.id.containerUuid)">
                
                <span class="drop-hint" *ngIf="draggedItem && canDropOnContainer(containerView.container.id.containerUuid)">
                  Drop here to add to {{containerView.name}}
                </span>
                <span class="drop-hint-no" *ngIf="draggedItem && !canDropOnContainer(containerView.container.id.containerUuid)">
                  Cannot drop here (full or same container)
                </span>
                <span *ngIf="!draggedItem">
                  <strong>{{containerView.name}}</strong> - {{containerView.container.currentCapacity}}/{{containerView.container.maxCapacity}}
                </span>
                <button
                  *ngIf="containerView.name !== 'Inventory'"
                  class="options-btn"
                  (click)="openDeleteContainerModal(containerView.container.id.containerUuid); $event.stopPropagation()"
                  title="Container options"
                >
                  â‹¯
                </button>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <div class="inventory-main">
      <div class="inventory-section">
        <!-- REMOVE THE INVENTORY HEADER FROM HERE - it's now at the top -->
        <!-- REMOVE THE SEARCH SECTION FROM HERE - it's now at the top -->
        
        <div class="inventory-scroll">
          <ul>
            <li *ngFor="let item of currentInventory; let i = index" 
                class="inventory-item" 
                draggable="true"
                (dragstart)="onDragStart($event, item)"
                (dragend)="onDragEnd($event)"
                (click)="openItemModal(item)"
                [class.dragging]="draggedItem === item">
              
              <div class="drag-handle" *ngIf="!draggedItem">
                <span class="drag-icon">â‹®â‹®</span>
              </div>
              
              <div class="item-content">
                <span>Name: {{ item.itemName || 'Unknown' }}</span> - 
                <span>Equipped: {{ item.equipped ? 'Yes' : 'No' }}</span> - 
                <span>Attuned: {{ item.attuned ? 'Yes' : 'No' }}</span> - 
                <span>Rarity: {{ item.itemRarity || 'Unknown' }}</span> - 
                <span>Quantity: {{ item.quantity || 0 }}</span> - 
                <span>Value: {{ item.itemValue || 0 }}</span> - 
                <span>Weight: {{ item.itemWeight || 0 }}</span>
              </div>
            </li>
          </ul>
        </div>

        <!-- Drag instructions -->
        <div class="drag-instructions" *ngIf="draggedItem">
          <p>ðŸ’¡ Drag the item to a container on the left to move it there.</p>
        </div>
      </div>
    </div>
    
  </div>
</div>

<!-- Modals remain the same -->
<div *ngIf="selectedItem" class="modal-overlay" (click)="closeItemModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h3>{{selectedItem.itemName}}</h3>
            <button class="close-button" (click)="closeItemModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="item-detail">
                <div class="item-has" *ngIf="selectedProject">
                    <span><strong>Quantity:</strong> 
                    <input 
                    type="text" 
                    [(ngModel)]="quantity" 
                    (input)="updateQuantity()" 
                    placeholder="{{quantity}}"
                    >
                </span>
                    <span><strong>Weight:</strong> {{selectedProject.itemWeight}}</span>
                </div>

                <div class="info-section">
                    <h4>Basic Information</h4>
                    <p><strong>Name:</strong> {{selectedItem.itemName}}</p>
                    <p *ngIf="selectedItem.itemDescription"><strong>Description:</strong> {{selectedItem.itemDescription}}</p>
                    <p *ngIf="selectedItem.itemWeight"><strong>Weight:</strong> {{selectedItem.itemWeight}}</p>
                    <p *ngIf="selectedItem.itemValue"><strong>Value:</strong> {{selectedItem.itemValue}}</p>
                    <p *ngIf="selectedItem.itemRarity"><strong>Rarity:</strong> {{selectedItem.itemRarity}}</p>
                </div>

                <div class="info-section" *ngIf="selectedItem.attackable || selectedItem.acBonus">
                    <h4>Combat Properties</h4>
                    <p *ngIf="selectedItem.attackable"><strong>Attackable:</strong> {{selectedItem.attackable}}</p>
                    <p *ngIf="selectedItem.acBonus"><strong>AC Bonus:</strong> {{selectedItem.acBonus}}</p>
                    <div *ngIf="selectedItem.addToAc && selectedItem.addToAc.size > 0">
                        <p><strong>Add to AC:</strong></p>
                        <ul>
                            <li *ngFor="let entry of getMapEntries(selectedItem.addToAc)">
                                {{entry.key}}: {{entry.value}}
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="info-section" *ngIf="selectedItem.equippable || selectedItem.attunable || selectedItem.itemEquippableTypes">
                    <h4>Equipment Properties</h4>
                    <p *ngIf="selectedItem.equippable"><strong>Equippable:</strong> {{selectedItem.equippable}}</p>
                    <p *ngIf="selectedItem.attunable"><strong>Requires Attunement:</strong> {{selectedItem.attunable}}</p>
                    <div *ngIf="selectedItem.itemEquippableTypes && selectedItem.itemEquippableTypes.length > 0">
                        <p><strong>Equipment Types:</strong></p>
                        <ul>
                            <li *ngFor="let type of selectedItem.itemEquippableTypes">{{type}}</li>
                        </ul>
                    </div>
                </div>

                <div class="info-section" *ngIf="selectedItem.abilityRequirement && selectedItem.abilityRequirement.size > 0">
                    <h4>Ability Requirements</h4>
                    <ul>
                        <li *ngFor="let entry of getMapEntries(selectedItem.abilityRequirement)">
                            {{entry.key}}: {{entry.value}}
                        </li>
                    </ul>
                </div>

                <div class="info-section" *ngIf="(selectedItem.skillAlteredRollType && selectedItem.skillAlteredRollType.size > 0) || (selectedItem.skillAlteredBonus && selectedItem.skillAlteredBonus.size > 0)">
                    <h4>Skill Modifiers</h4>
                    <div *ngIf="selectedItem.skillAlteredRollType && selectedItem.skillAlteredRollType.size > 0">
                        <p><strong>Roll Type Alterations:</strong></p>
                        <ul>
                            <li *ngFor="let entry of getMapEntries(selectedItem.skillAlteredRollType)">
                                {{entry.key}}: {{entry.value}}
                            </li>
                        </ul>
                    </div>
                    <div *ngIf="selectedItem.skillAlteredBonus && selectedItem.skillAlteredBonus.size > 0">
                        <p><strong>Skill Bonuses:</strong></p>
                        <ul>
                            <li *ngFor="let entry of getMapEntries(selectedItem.skillAlteredBonus)">
                                {{entry.key}}: +{{entry.value}}
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="info-section" *ngIf="selectedItem.isContainer">
                    <h4>Container Properties</h4>
                    <p><strong>Is Container:</strong> {{selectedItem.isContainer}}</p>
                    <p *ngIf="selectedItem.capacity"><strong>Capacity:</strong> {{selectedItem.capacity}}</p>
                </div>

                <div class="info-section" *ngIf="selectedItem.classNameIdPair && selectedItem.classNameIdPair.length > 0">
                    <h4>Class Requirements</h4>
                    <ul>
                        <li *ngFor="let classPair of selectedItem.classNameIdPair">
                            {{classPair.className}}
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="modal-footer">
              
            <div class="delete-item-section">
              <button (click)="deleteItem()">Delete</button>
            </div>

            <button class="btn btn-secondary" (click)="closeItemModal()">Close</button>
        </div>
    </div>
</div>

<div
  *ngIf="deleteModalOpen"
  class="modal-overlay"
  (click)="closeDeleteContainerModal()"
>
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Delete Container</h3>
      <button class="close-button" (click)="closeDeleteContainerModal()">
        &times;
      </button>
    </div>

    <div class="modal-body">
      <p>Are you sure you want to delete this container?  
         <strong>This action cannot be undone.</strong>
      </p>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeDeleteContainerModal()">
        Cancel
      </button>
      <button class="btn btn-danger" (click)="confirmDeleteContainer()">
        Delete
      </button>
    </div>
  </div>
</div>