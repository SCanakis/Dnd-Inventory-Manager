<div class="item-catalog-container">
  <app-basic-character-info-component></app-basic-character-info-component>
  <app-nav-component></app-nav-component>

  <div class="catalog-header">
    <h2>Item Catalog:</h2>
  </div>

  <div class="catalog-search">
    <input 
      type="text" 
      [(ngModel)]="searchTerm" 
      (input)="onSearchTerm()"
      placeholder="Search items by name">
  </div>

  <div class="catalog-items">
    <ul>
      <li *ngFor="let item of items" (click)="openItemModal(item)" class="item-catalog-list">
        <span class="item-name">{{item.itemName}}</span>
        <span class="item-weight">{{item.itemWeight}}</span>
        <span class="item-value">{{item.itemValue}}</span>
        <span class="item-rarity" [attr.data-rarity]="item.itemRarity">{{item.itemRarity}}</span>
      </li>
    </ul>
  </div>
</div>

<div *ngIf="selectedItem" class="modal-overlay" (click)="closeItemModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>{{selectedItem.itemName}}</h3>
      <button class="close-button" (click)="closeItemModal()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="item-detail">
        <!-- Basic Info -->
        <div class="info-section">
          <h4>Basic Information</h4>
          <p><strong>Name:</strong> {{selectedItem.itemName}}</p>
          <p *ngIf="selectedItem.itemDescription"><strong>Description:</strong></p>
          <p>{{selectedItem.itemDescription}}</p>
          <p *ngIf="selectedItem.itemWeight"><strong>Weight:</strong> {{selectedItem.itemWeight}}</p>
          <p *ngIf="selectedItem.itemValue"><strong>Value:</strong> {{selectedItem.itemValue}}</p>
          <p *ngIf="selectedItem.itemRarity"><strong>Rarity:</strong> {{selectedItem.itemRarity}}</p>
        </div>

        <!-- Combat Properties -->
        <div class="info-section" *ngIf="selectedItem.attackable || selectedItem.acBonus">
          <h4>Combat Properties</h4>
          <p *ngIf="selectedItem.attackable"><strong>Attackable:</strong> {{selectedItem.attackable}}</p>
          <p *ngIf="selectedItem.acBonus"><strong>AC Bonus:</strong> {{selectedItem.acBonus}}</p>
          <div *ngIf="selectedItem.addToAc && selectedItem.addToAc.size > 0">
            <p><strong>Add to AC:</strong></p>
            <ul>
              <li *ngFor="let entry of getMapEntries(selectedItem.addToAc)">
                {{entry.key}}: {{entry.value}}
              </li>
            </ul>
          </div>
        </div>

        <!-- Equipment Properties -->
        <div class="info-section" *ngIf="selectedItem.equippable || selectedItem.attunable || selectedItem.itemEquippableTypes">
          <h4>Equipment Properties</h4>
          <p *ngIf="selectedItem.equippable"><strong>Equippable:</strong> {{selectedItem.equippable}}</p>
          <p *ngIf="selectedItem.attunable"><strong>Requires Attunement:</strong> {{selectedItem.attunable}}</p>
          <div *ngIf="selectedItem.itemEquippableTypes && selectedItem.itemEquippableTypes.length > 0">
            <p><strong>Equipment Types:</strong></p>
            <ul>
              <li *ngFor="let type of selectedItem.itemEquippableTypes">{{type}}</li>
            </ul>
          </div>
        </div>

        <!-- Ability Requirements -->
        <div class="info-section" *ngIf="selectedItem.abilityRequirement && selectedItem.abilityRequirement.size > 0">
          <h4>Ability Requirements</h4>
          <ul>
            <li *ngFor="let entry of getMapEntries(selectedItem.abilityRequirement)">
              {{entry.key}}: {{entry.value}}
            </li>
          </ul>
        </div>

        <!-- Skill Modifiers -->
        <div class="info-section" *ngIf="(selectedItem.skillAlteredRollType && selectedItem.skillAlteredRollType.size > 0) || (selectedItem.skillAlteredBonus && selectedItem.skillAlteredBonus.size > 0)">
          <h4>Skill Modifiers</h4>
          <div *ngIf="selectedItem.skillAlteredRollType && selectedItem.skillAlteredRollType.size > 0">
            <p><strong>Roll Type Alterations:</strong></p>
            <ul>
              <li *ngFor="let entry of getMapEntries(selectedItem.skillAlteredRollType)">
                {{entry.key}}: {{entry.value}}
              </li>
            </ul>
          </div>
          <div *ngIf="selectedItem.skillAlteredBonus && selectedItem.skillAlteredBonus.size > 0">
            <p><strong>Skill Bonuses:</strong></p>
            <ul>
              <li *ngFor="let entry of getMapEntries(selectedItem.skillAlteredBonus)">
                {{entry.key}}: +{{entry.value}}
              </li>
            </ul>
          </div>
        </div>

        <div class="info-section" *ngIf="selectedItem.isContainer">
          <h4>Container Properties</h4>
          <p><strong>Is Container:</strong> {{selectedItem.isContainer}}</p>
          <p *ngIf="selectedItem.capacity"><strong>Capacity:</strong> {{selectedItem.capacity}}</p>
        </div>

        <div class="info-section" *ngIf="selectedItem.classNameIdPair && selectedItem.classNameIdPair.length > 0">
          <h4>Class Requirements</h4>
          <ul>
            <li *ngFor="let classPair of selectedItem.classNameIdPair">
              {{classPair.className}}
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <!-- Quantity selection section - only show for non-containers -->
      <div class="add-item-section">
        <div *ngIf="canChooseQuantity" class="quantity-section">
          <label for="quantity">Quantity:</label>
          <input 
            type="number"
            id="quantity"
            [(ngModel)]="quantity"
            (input)="onQuantityChange($any($event.target).value)"
            min="1"
            step="1"
            class="quantity-input">
        </div>
        
        <div class="action-buttons">
          <button 
            (click)="addItem()"
            [disabled]="!canAddItem"
            class="btn btn-primary add-item-btn">
            Add Item
          </button>
          <button class="btn btn-secondary" (click)="closeItemModal()">Close</button>
        </div>
      </div>
    </div>
  </div>
</div>